//
// cfg file to run L1 muon chain + L1 calorimeter chain + L1 Global Trigger emulators 
// on GEN + SIM + DIGI events 
//

process RunGlobalTriggerDigi = {

    // input file: GEN + SIM + DIGI 
    source = PoolSource {
	    untracked vstring fileNames = {
        "/store/RelVal/2007/9/4/RelVal-RelVal145QCD_pt80_120-1188895669/0002/58299D7E-E85A-DC11-9677-00304855D4C8.root"
	    }
    }

    //replace PoolSource.fileNames = {
    //    "/store/RelVal/2007/9/4/RelVal-RelVal145Z-MM-1188895669/0002/6A37C29B-D65A-DC11-88A0-001617E30D06.root"
    //}
    
    
    untracked PSet maxEvents = { untracked int32 input = 250 }

    // load and configure modules

    // Emulator configuration
    // select one of the two lines below
    // By default (17X) take configuration from dummy producers

    include "L1Trigger/Configuration/data/L1DummyConfig.cff"
    //include "L1Trigger/Configuration/data/L1DBConfig.cff"
    
    // uprescaled menu - change prescale factors to 1 (except MinBias and ZeroBias)
    //include "L1TriggerConfig/L1GtConfigProducers/data/L1GtFactorsUnprescale.cff"
        
    // Geometry - to be revised
    include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
    include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
    
    // calorimeter emulator chain
    include "L1Trigger/Configuration/data/L1CaloEmulator.cff"

    // muon emulator chain 
    //   depends on calorimeter chain
    include "L1Trigger/Configuration/data/L1MuonEmulator.cff"

    // Global Trigger emulator
    //   depends on calorimeter chain and muon chain
    include "L1Trigger/GlobalTrigger/data/gtDigis.cfi"
    
    
    
    // logical flag to produce the L1 GT DAQ readout record
    //     if true, produce the record (default)
    //replace gtDigis.ProduceL1GtDaqRecord = false
    
    // logical flag to produce the L1 GT EVM readout record
    //     if true, produce the record (default)
    //replace gtDigis.ProduceL1GtEvmRecord = false

    // logical flag to produce the L1 GT object map record
    //     if true, produce the record (default)
    //replace gtDigis.ProduceL1GtObjectMapRecord = false

    // logical flag to write the PSB content in the  L1 GT DAQ record
    //     if true, write the PSB content in the record (default)
    //replace gtDigis.WritePsbL1GtDaqRecord = false


    
    // module list
    path p = { L1CaloEmulator, L1MuonEmulator, gtDigis }

    // uncomment / comment messages with DEBUG mode to run in DEBUG mode
    service = MessageLogger {

        untracked vstring destinations =  {"L1GlobalTrigger_RelVal145QCD_pt80_120"}
//        untracked vstring destinations =  {"L1GlobalTrigger_RelVal145Z-MM"}

        untracked PSet L1GlobalTrigger_RelVal145QCD_pt80_120 = { 
//        untracked PSet L1GlobalTrigger_RelVal145Z-MM = { 

            //untracked string threshold = "DEBUG"                  // DEBUG 
            //untracked PSet DEBUG = { untracked int32 limit = -1}  // DEBUG, all messages  
            //untracked PSet DEBUG = { untracked int32 limit = 10}  // DEBUG, max 10 messages  
            untracked PSet INFO = { untracked int32 limit = -1}    

        }
    //untracked vstring debugModules = { "gtDigis"}              // DEBUG  
      
    }

    // keep only GMT, GCT and GT output records
    // update labels if InputTags are replaced!
            
    module outputL1GlobalTrigger = PoolOutputModule { 
        untracked vstring outputCommands = {
            "drop *",
            "keep *_gmtDigis_*_*",
            "keep *_gctDigis_*_*",
            "keep *_gtDigis_*_*"
        }

        untracked string fileName = "L1GlobalTrigger_RelVal145QCD_pt80_120.root" 
//        untracked string fileName = "L1GlobalTrigger_RelVal145Z-MM.root" 

    }
    
    endpath outpath = { outputL1GlobalTrigger }
    
        
}